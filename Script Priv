--// Services
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Workspace = game:GetService("Workspace")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local VirtualInput = game:GetService("VirtualInputManager")
local HttpService = game:GetService("HttpService")

--// Whitelist System
local whitelist = {
    8172479471,
    2880637817,
    1522608840,
    7600805172,
}

local function checkWhitelist()
    local userId = LocalPlayer.UserId
    print("Your UserId:", userId)
    for _, id in ipairs(whitelist) do
        if tonumber(id) == userId then
            print("✅✅ You are whitelisted!")
            return true
        end
    end
    warn("❌❌ You are NOT whitelisted.")
    return false
end
if not checkWhitelist() then
    LocalPlayer:Kick("You are not whitelisted.")
    return
end

--// Load UI Library
local DrRayLibrary = loadstring(game:HttpGet("https://raw.githubusercontent.com/AZYsGithub/DrRay-UI-Library/main/DrRay.lua"))()

--// GUI Setup
local window = DrRayLibrary:Load("Canes Priv Script", "Default")
local tab = DrRayLibrary.newTab("Rock Farm", "https://www.roblox.com/asset-thumbnail/image?assetId=1234567890&width=100&height=100&format=png")
tab.newLabel("Welcome to the Rock Farm script!")

--// Variables
local autoFarm = false
local punchDelay = 0.1
local selectRock = ""
local equippedTool = nil
local farmThread = nil

--// Get Durability safely
local function getDurability()
    local durabilityStat = LocalPlayer:FindFirstChild("Durability") or (LocalPlayer:FindFirstChild("leaderstats") and LocalPlayer.leaderstats:FindFirstChild("Durability"))
    return durabilityStat and durabilityStat.Value or 0
end

--// Equip Punch Tool
function equipPunchTool()
    if equippedTool and equippedTool.Parent == LocalPlayer.Character then return end
    for _, tool in pairs(LocalPlayer.Backpack:GetChildren()) do
        if tool:IsA("Tool") and tool.Name:find("Punch") then
            tool.Parent = LocalPlayer.Character
            equippedTool = tool
            return
        end
    end
    warn("No punch tool found!")
end

--// Auto Punch Function
function autoPunchRock(rockName, requiredDurability)
    if farmThread then task.cancel(farmThread) end
    farmThread = task.spawn(function()
        equipPunchTool()
        while autoFarm and selectRock == rockName do
            task.wait(punchDelay)
            if getDurability() >= requiredDurability then
                for _, machine in pairs(Workspace.machinesFolder:GetChildren()) do
                    if machine:IsA("Model") and machine.Name == rockName then
                        local rock = machine:FindFirstChild("Rock") or machine:FindFirstChildWhichIsA("BasePart")
                        if rock then
                            local character = LocalPlayer.Character
                            if character:FindFirstChild("LeftHand") and character:FindFirstChild("RightHand") then
                                for _, hand in ipairs({"RightHand", "LeftHand"}) do
                                    LocalPlayer.muscleEvent:FireServer("punch", hand)
                                    firetouchinterest(rock, character[hand], 0)
                                    firetouchinterest(rock, character[hand], 1)
                                end
                            end
                        end
                    end
                end
            end
        end
    end)
end

--// Rock Toggles
local rockData = {
    {"Auto Punch Jungle Rock (10M)", "Ancient Jungle Rock", 10000000},
    {"Auto Punch King Rock (5M)", "Muscle King Mountain", 5000000},
    {"Auto Punch Legend Rock (1M)", "Rock Of Legends", 1000000},
    {"Auto Punch Inferno Rock (750K)", "Inferno Rock", 750000},
    {"Auto Punch Mythical Rock (400K)", "Mythic Rock", 400000},
    {"Auto Punch Frost Rock (150K)", "Frozen Rock", 150000},
    {"Auto Punch Tiny Rock (0)", "Tiny Rock", 0}
}

for _, data in ipairs(rockData) do
    local label, rock, dur = unpack(data)
    tab.newToggle(label, label, false, function(state)
        autoFarm = state
        selectRock = state and rock or ""
        if autoFarm then
            autoPunchRock(rock, dur)
        end
    end)
end

--// Punch Delay Slider
tab.newSlider("Punch Delay", "Set the delay between punches", 0.1, 2, 0.1, function(value)
    punchDelay = value
end)

--// Rebirth Tab Setup
local rebirthTab = DrRayLibrary.newTab("Rebirth", "https://www.roblox.com/asset-thumbnail/image?assetId=1234567890&width=100&height=100&format=png")
rebirthTab.newLabel("Welcome to the Rebirth features tab!")

--// Pet Equip Functions
local function unequipAllPets()
    for _, folder in pairs(LocalPlayer.petsFolder:GetChildren()) do
        if folder:IsA("Folder") then
            for _, pet in pairs(folder:GetChildren()) do
                ReplicatedStorage.rEvents.equipPetEvent:FireServer("unequipPet", pet)
            end
        end
    end
    task.wait(0.1)
end

function equipPetByName(name)
    unequipAllPets()
    task.wait(0.01)
    for _, pet in pairs(LocalPlayer.petsFolder.Unique:GetChildren()) do
        if pet.Name == name then
            ReplicatedStorage.rEvents.equipPetEvent:FireServer("equipPet", pet)
        end
    end
end

--// Find & Press Helpers
function findMachine(name)
    for _, machine in pairs(Workspace.machinesFolder:GetChildren()) do
        if machine.Name == name then
            return machine
        end
    end
end

function pressE()
    VirtualInput:SendKeyEvent(true, Enum.KeyCode.E, false, game)
    task.wait()
    VirtualInput:SendKeyEvent(false, Enum.KeyCode.E, false, game)
end

--// Toggle Variables
local autoRep = false
local autoRebirth = false
local fastRebirth = false
local statusLabel = rebirthTab.newLabel("Status: Idle")

--// Rebirth Tab Toggles
rebirthTab.newButton("Equip Swift Samurai", "Equip the Swift Samurai pet", function()
    equipPetByName("Swift Samurai")
end)

rebirthTab.newToggle("Auto Rep", "Auto Rep(With Packs", false, function(state)
    autoRep = state
end)

rebirthTab.newToggle("Auto Rebirth", "Auto Rebirth(Normal", false, function(state)
    autoRebirth = state
end)

rebirthTab.newToggle("Toggle Fast Rebirth", "Fast Rebirth(With Packs", false, function(state)
    fastRebirth = state
end)

--// UI Options Tab Setup
local uiTab = DrRayLibrary.newTab("UI Options", "https://www.roblox.com/asset-thumbnail/image?assetId=1234567890&width=100&height=100&format=png")
uiTab.newLabel("UI customization settings")

--// Hide All Frames Toggle
uiTab.newToggle("Hide All Frames", "Suggest Using For Auto Rep", false, function(state)
    for _, obj in pairs(ReplicatedStorage:GetChildren()) do
        if obj:IsA("Instance") and obj.Name:match("Frame$") then
            obj.Visible = not state
        end
    end
end)

--// Loops
task.spawn(function()
    while true do
        if autoRep then
            for _ = 1, 200 do
                LocalPlayer.muscleEvent:FireServer("rep")
            end
        end
        task.wait(0.01)
    end
end)

--// Fast Rebirth Loop
local a=game:GetService("ReplicatedStorage")local b=game:GetService("Players")local c=b.LocalPlayer;local d=function()local e=c.petsFolder;for f,g in pairs(e:GetChildren())do if g:IsA("Folder")then for h,i in pairs(g:GetChildren())do a.rEvents.equipPetEvent:FireServer("unequipPet",i)end end end;task.wait(0.1)end;local j=function(k)d()task.wait(0.01)for l,m in pairs(c.petsFolder.Unique:GetChildren())do if m.Name==k then a.rEvents.equipPetEvent:FireServer("equipPet",m)end end end;local n=function(o)local p=workspace.machinesFolder:FindFirstChild(o)if not p then for q,r in pairs(workspace:GetChildren())do if r:IsA("Folder")and r.Name:find("machines")then p=r:FindFirstChild(o)if p then break end end end end;return p end;local s=function()local t=game:GetService("VirtualInputManager")t:SendKeyEvent(true,"E",false,game)task.wait(0.1)t:SendKeyEvent(false,"E",false,game)end;task.spawn(function()while true do if fastRebirth then local u=c.leaderstats.Rebirths.Value;local v=10000+5000*u;if c.ultimatesFolder:FindFirstChild("Golden Rebirth")then local w=c.ultimatesFolder["Golden Rebirth"].Value;v=math.floor(v*(1-w*0.1))end;d()task.wait(0.1)j("Swift Samurai")while c.leaderstats.Strength.Value<v do for x=1,60 do c.muscleEvent:FireServer("rep")end;task.wait(0.05)end;d()task.wait(0.1)j("Tribal Overlord")local y=n("Jungle Bar Lift")if y and y:FindFirstChild("interactSeat")then c.Character.HumanoidRootPart.CFrame=y.interactSeat.CFrame*CFrame.new(0,3,0)repeat task.wait(0.1)s()until c.Character.Humanoid.Sit end;local z=c.leaderstats.Rebirths.Value;repeat a.rEvents.rebirthRemote:InvokeServer("rebirthRequest")task.wait(0.1)until c.leaderstats.Rebirths.Value>z;task.wait()end task.wait(0.1) end end)

--// Send Join Message
local success, err = pcall(function()
    ReplicatedStorage.DefaultChatSystemChatEvents.SayMessageRequest:FireServer("Loaded ✅: PRIVATE SCRIPT Made by Canes(CLK ON TOP)", "All")
end)
if not success then
    warn("Failed to send chat message:", err)
end

